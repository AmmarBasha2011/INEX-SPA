#!/usr/bin/env php
<?php
/**
 * INEX SPA CLI Tool - "ammar"
 *
 * Refactored version with separated command files and colorful UI.
 */

require_once __DIR__ . '/core/ammar/loader.php';

$commandName = $argv[1] ?? 'list';
$args = [];

// Basic argument parsing: -1 value1 -2 value2 ...
for ($i = 2; $i < count($argv); $i += 2) {
    if (isset($argv[$i + 1]) && str_starts_with($argv[$i], '-')) {
        $args[str_replace('-', '', $argv[$i])] = $argv[$i + 1];
    } else if (isset($argv[$i])) {
        // Fallback for simple arguments without - prefix if they are in position 2, 3 etc.
        // But the original ammar script used -1, -2 etc.
        // We keep compatibility but also allow just passing them.
        $args[($i-1)] = $argv[$i];
    }
}

$command = $registry->getCommand($commandName);

if ($command) {
    try {
        $command->execute($args);
    } catch (Exception $e) {
        Terminal::error("Execution Error: " . $e->getMessage());
    }
} else {
    Terminal::error("Unknown command: " . Terminal::color($commandName, 'bold'));
    $registry->getCommand('list')->execute([]);
    exit(1);
}
